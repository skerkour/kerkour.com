+++
date = 2022-05-26T02:00:00Z
title = "Defending against malicious bots with a zip bomb"
type = "post"
tags = ["hacking", "programming", "tutorial"]
authors = ["Sylvain Kerkour"]
url = "/zip-bomb"

[extra]
lang = "en"

comment ="""
"""
+++

Malicious bots can cause a lot of damages to your websites whether it be stealing your content or scanning for vulnerabilities.

Here is how to defend against them.

> This post is an excerpt from my book [Black Hat Rust](https://kerkour.com/black-hat-rust)

A zip bomb is a specifically crafted archive abusing the compression algorithms to create a `.zip` or `.gzip` file that is small (a few kilobytes/megabytes), but once uncompressed weights many gigabytes, which will lead scrapers and crawlers to exhaust all their resources until the crash.

Here is how to create such a file:

```bash
$ dd if=/dev/zero bs=1M count=10000 | gzip > 10G.gzip
$ du -sh 10G.gzip
$ 10M     10G.gzip
```

Then, when a bot is detected, serve this file instead of a legitimate HTML page:

```javascript
function serve_page(req, res) {
    if (bot_is_detected()) {
        res.set_header("Content-Encoding", "gzip")
        return res.send_file("10G.gzip");
    }
}
```

Why GZip? Because GZip is almost universally automatically handled by existing HTTP clients. Thus just by requesting the URL, the crawler is going to automagically crash.
